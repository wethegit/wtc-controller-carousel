"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _wtcControllerElement=_interopRequireWildcard(require("wtc-controller-element")),_wtcUtilityBreakpoint=_interopRequireDefault(require("wtc-utility-breakpoint"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};desc.get||desc.set?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,newObj}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?_assertThisInitialized(self):call}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}var Carousel=function(){function Carousel(element){var _this;_classCallCheck(this,Carousel),(_this=_possibleConstructorReturn(this,_getPrototypeOf(Carousel).call(this,element))).el=element,_this.container=_this.el.querySelector(".carousel__container"),_this.children=[];for(var i=0;i<_this.container.children.length;i++)_this.children.push(_this.container.children[i].cloneNode(!0));return _this.nextChild=0,_this.onPointerLeave=_this.onPointerLeave.bind(_assertThisInitialized(_this)),_this.onPointerMove=_this.onPointerMove.bind(_assertThisInitialized(_this)),_this.onResize=_this.onResize.bind(_assertThisInitialized(_this)),_this.run=_this.run.bind(_assertThisInitialized(_this)),_this.el.addEventListener("pointermove",_this.onPointerMove),_this.el.addEventListener("pointerleave",_this.onPointerLeave),_this.testSize(),_this.animating=!0,_this}return _inherits(Carousel,_wtcControllerElement["default"]),_createClass(Carousel,[{key:"testSize",value:function(){var _this2=this,addWidth=this.width-this.offset;if(this.childWidth<addWidth){for(var breaker=0,existingChildren=this.container.children,addedOffset=0,toRemove=[],i=0;i<existingChildren.length;i++){var child=existingChildren[i],offsetLeft=child.offsetLeft+this.offset,offsetWidth=child.offsetWidth;offsetLeft<-offsetWidth&&(toRemove.push(child),addedOffset+=offsetWidth)}for(toRemove.forEach(function(child){_this2.container.removeChild(child)}),this.offset+=addedOffset,addWidth-=addedOffset;this.childWidth<addWidth;){this.container.appendChild(this.children[this.nextChild++].cloneNode(!0));var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=this.container.querySelectorAll("[data-controller]")[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var element=_step.value;element.data&&element.data.instanciated||_wtcControllerElement.ExecuteControllers.instanciate(element,element.getAttribute("data-controller"))}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}if(100<++breaker)break}}}},{key:"onPointerMove",value:function(e){var paused=function hasClass(element){return!(!element||!element.parentNode||element.classList.contains("carousel__container"))&&(!!element.classList.contains("carousel__frame--hover")||hasClass(element.parentNode))}(e.target);this.hovered=paused}},{key:"onPointerLeave",value:function(e){this.hovered=!1}},{key:"onResize",value:function(e){this.testSize()}},{key:"run",value:function(delta){this.paused||(this.offset-=this.speed,this.testSize()),this.animating&&requestAnimationFrame(this.run)}},{key:"childWidth",get:function(){for(var children=this.container.children,width=0,i=0;i<children.length;i++)width+=children[i].offsetWidth;return width}},{key:"width",get:function(){return this.el.offsetWidth}},{key:"nextChild",set:function(value){this._nextChild=value%this.children.length},get:function(){return this._nextChild}},{key:"speed",set:function(value){0<=value&&(this._speed=value)},get:function(){return this._speed||this.basicSpeed}},{key:"basicSpeed",get:function(){return _wtcUtilityBreakpoint.default.current/10+.6}},{key:"offset",set:function(value){isNaN(value)||(this._offset=value,this.container.style.transform="translate3d(".concat(value,"px, 0, 1px)"))},get:function(){return this._offset||0}},{key:"paused",set:function(value){this._paused=!0===value},get:function(){return!0===this._paused}},{key:"hovered",set:function(value){var _this3=this,oldValue=this.hovered;if(this._hovered=!0===value,oldValue!==value){var transitioned=!1,targetSpeed=!0===value?.1*this.basicSpeed:this.basicSpeed;requestAnimationFrame(function transition(){var step=.05*(targetSpeed-_this3.speed);_this3.speed=_this3.speed+step,Math.abs(_this3.speed-targetSpeed)<.01&&(transitioned=!0),transitioned||_this3.hovered!==value||requestAnimationFrame(transition)})}},get:function(){return!0===this._hovered}},{key:"animating",set:function(value){!0===value&&!0!==this.animating&&requestAnimationFrame(this.run),this._animating=!0===value},get:function(){return!0===this._animating}}]),Carousel}();_wtcControllerElement.ExecuteControllers.registerController(Carousel,"Carousel");var _default=Carousel;exports.default=_default;